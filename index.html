<!DOCTYPE html>
<html>
<head>
  <title>FHIR Profiles Table</title>
  <meta charset="utf-8">
</head>
<body>
  <input type="text" id="search" placeholder="Filter table..." onkeyup="filterTable()">
  <input type="text" id="typeFilter" placeholder="Filter by Type..." onkeyup="filterTypeColumn()">
<table id="myTable" border="1">
    <thead>
        <tr id="headerRow"></tr>
    </thead>
    <tbody id="tableBody"></tbody>
</table>
<script>
    // Fetch and load JSON data when the page loads
    document.addEventListener('DOMContentLoaded', function() {
        fetch('all_profiles_combined.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                renderTable(data);
            })
            .catch(error => {
                console.error('Error loading JSON:', error);
                document.getElementById('tableBody').innerHTML = '<tr><td colspan="100">Error loading data</td></tr>';
            });
    });

    function renderTable(data) {
        if (!Array.isArray(data) || data.length === 0) {
            document.getElementById('tableBody').innerHTML = '<tr><td>No data available</td></tr>';
            return;
        }

        // Define the columns to display
        const columns = [
            'name',
            'url',
            'default_branch',
            'structure_url',
            'resourceType',
            'meta_profile',
            'type',
            'file_name',
            'raw_url'
        ];

        // Create header row
        const headerRow = document.getElementById('headerRow');
        headerRow.innerHTML = '';
        const headers = [
            'Name',
            'Repo URL',
            'Default Branch',
            'StructureDefinition URL',
            'Resource Type',
            'Meta Profile',
            'Type',
            'File Name',
            'Raw URL'
        ];
        headers.forEach(header => {
            const th = document.createElement('th');
            th.textContent = header;
            headerRow.appendChild(th);
        });

        // Create table rows for each structure_definition
        const tableBody = document.getElementById('tableBody');
        tableBody.innerHTML = '';
        data.forEach(item => {
            if (Array.isArray(item.structure_definitions)) {
                item.structure_definitions.forEach(sd => {
                    const row = document.createElement('tr');
                    // Add parent fields
                    [item.name, item.url, item.default_branch].forEach(val => {
                        const td = document.createElement('td');
                        td.textContent = val;
                        row.appendChild(td);
                    });
                    // Add structure_definition fields
                    [sd.url, sd.resourceType, sd.meta_profile, sd.type, sd.file_name, sd.raw_url].forEach(val => {
                        const td = document.createElement('td');
                        td.textContent = val;
                        row.appendChild(td);
                    });
                    tableBody.appendChild(row);
                });
            }
        });
    }
  </script>
  <script>
    function filterTable() {
      let input = document.getElementById('search').value.toLowerCase();
      let rows = document.querySelectorAll('#myTable tbody tr');
      rows.forEach(row => {
        // The 'Type' column is the 7th column (index 6)
        let typeCell = row.cells[6];
        if (typeCell && typeCell.textContent.toLowerCase().includes(input)) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      });
    }
  </script>
  <script>
    function filterTypeColumn() {
      let input = document.getElementById('typeFilter').value.toLowerCase();
      let rows = document.querySelectorAll('#myTable tbody tr');
      rows.forEach(row => {
        // The 'Type' column is the 7th column (index 6)
        let typeCell = row.cells[6];
        if (typeCell && typeCell.textContent.toLowerCase().includes(input)) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      });
    }
  </script>
</body>
</html>
